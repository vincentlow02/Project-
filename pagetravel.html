<!DOCTYPE html>

<html lang="ja">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">

  <title>&#26908;&#32034;&#32080;&#26524; | Weave Travel</title>



  <style>



   

  .ques-icon {

    position: absolute;

    top: 512px;   /* 控制ques在Rectangle上的纵向位置 */

    left: -670px;  /* 控制ques的横向位置 */

    width: 360px;  /* 调整大小 */

    z-index: 11;  /* 比 logo 略高，确保显示在上层 */

    transition: transform 0.3s ease;

  }



  .ques-icon:hover {

    transform: scale(1.05);

  }

  /* ================================

     Hokkaido Logo Overlay

     ================================ */

  .hokkaido-logo-container {

    position: relative; /* 让内部 absolute 定位参考这个容器 */

    display: inline-block;

  }



  /* 让 logo 叠在 Rectangle205.svg 上方 */

  .hokkaido-logo {

    position: absolute;

    top: 17px;   /* 调整 logo 距离矩形顶部的距离 */

    left: -590px;  /* 调整 logo 距离矩形左侧的距离 */

    width: 220px; /* 可根据需求调整 logo 大小 */

    z-index: 10;  /* 确保 logo 显示在 Rectangle205.svg 上层 */

    transition: transform 0.3s ease;

  }



  /* 可选：添加一个 hover 动效，让 logo 稍微放大一点 */

  .hokkaido-logo:hover {

    transform: scale(1.05);

  }



  /* Vimeo player container positioned where the frame should sit */

  .hokkaido-video-container {

    position: absolute;

    top: 69px;   /* 调整到矩形上适合的位置 */

    left: -900px;

    width: min(860px, 60vw);

    aspect-ratio: 1260 / 710; /* 与 SVG 原始宽高比一致 */

    border-radius: 1203px;

  }



  /* Wrapper keeps the iframe sized to the container */

  .vimeo-wrapper {

    position: absolute;

    top: 14px;    /* 对齐 SVG 内部矩形的起始高度 */

    right: 10px;

    bottom: 3px;

    left: 0px;

    overflow: hidden;

    border-radius: 44px; /* 匹配 SVG 的圆角 */

    z-index: 1;

    transform: scale(1.034);

  }



  .vimeo-iframe {

    position: absolute;

    inset: 0;

    width: 101%;

    height: 99%;

    border: 0;

    object-fit: cover; /* 填满容器且保持比例 */

    border-radius: 20px;

  }



  /* 点击区域用于触发播放/暂停，预留底部空间给原生控制条 */

  .vimeo-toggle-hitbox {

    position: absolute;

    top: 10px;

    left: 3px;

    right: 3px;

    bottom: calc(3px + 80px); /* 预留底部控制条，避免遮挡 */

    cursor: pointer;

    z-index: 2;

    background: transparent;

  }



  /* decorative frame remains visible, pointer-events disabled to keep iframe clickable */

  .hokkaido-video-frame {

    position: absolute;

    inset: 0;

    width: 100%;

    height: 100%;

    z-index: 3;

    pointer-events: none;

    transition: transform 0.3s ease;

  }



 

    .rectangle-comment {

  position: absolute;

  top: 50px; /* 距离视频顶部 */

  left: 20px; /* 距离视频左侧 */

  width: 610px; /* 可根据需求调整大小 */

  height: auto;

  z-index: 20; /* 必须比 iframe 和 frame 高 */

  pointer-events: none; /* 保证点击事件透传到视频 */

}





  .subtitle-container {

    position: absolute;

    top: 60px;

    left: 40px;

    width: min(560px, calc(100% - 160px));

    display: flex;

    flex-direction: column;

    align-items: flex-start;

    gap: 4px;

    z-index:  9999;

    pointer-events: none;

    font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;

  }



  .subtitle-line {

    display: inline-flex;

    align-items: baseline;

    white-space: pre-wrap;

  }



  .subtitle-text {

    display: inline;

  }



  .subtitle-title {

    font-size: 14px;

    font-weight: 700;

    color: black;

    letter-spacing: 0.06em;

    line-height: 1.25;s

  }



  .subtitle-description {

    font-size:10px;

    font-weight: 400;

    color:black;

    line-height: 1.7;

    letter-spacing: 0.03em;

    max-width: 540px;

    text-align: left;

  }



  .subtitle-description .subtitle-text {

    display: inline;

  }



  .subtitle-cursor {

    margin-left: 0.2em;

    width: 0.4em;

    animation: subtitle-cursor-blink 1.05s steps(1, start) infinite;

    opacity: 0;

  }



  .subtitle-line.is-typing .subtitle-cursor {

    opacity: 1;

  }



  .subtitle-line.is-complete .subtitle-cursor {

    opacity: 0;

    animation: none;

  }



  @keyframes subtitle-cursor-blink {

    0%, 100% {

      opacity: 1;

    }

    50% {

      opacity: 0.2;

    }

  }



html, body {

  width: 154vw;  /* 页面宽度是视窗宽度的两倍，可根据需要调 */

  height: 101vh; /* 高度与视窗一致 */

  overflow-y: hidden;

  overflow-x: auto;  /* 手动滚动（非auto） */

  scroll-behavior: smooth;

}



body.is-custom-fullscreen,

html.is-custom-fullscreen {

  overflow: hidden;

}



.custom-fullscreen-overlay {

  position: fixed;

  inset: 0;

  background: #000;

  display: flex;

  align-items: stretch;

  justify-content: stretch;

  opacity: 0;

  pointer-events: none;

  transition: opacity 0.25s ease;

  z-index: 12000;

}



body.is-custom-fullscreen .custom-fullscreen-overlay {

  opacity: 1;

  pointer-events: auto;

}



.custom-fullscreen-wrapper {

  display: flex;

  width: 100%;

  height: 100%;

  align-items: stretch;

  justify-content: stretch;

  background: transparent;

}



.custom-fullscreen-video-area {

  flex: 1 1 auto;

  display: flex;

  align-items: stretch;

  justify-content: stretch;

  min-width: 0;

  min-height: 0;

  background: #000;

}



.custom-fullscreen-video-viewport {

  position: relative;

  flex: 1 1 auto;

  display: flex;

  align-items: stretch;

  justify-content: stretch;

  width: 100%;

  height: 100%;

  min-width: 0;

  min-height: 0;

}



.custom-fullscreen-sidebar {

  flex: 0 0 300px;

  max-width: 300px;

  display: flex;

  flex-direction: column;

  gap: 16px;

  padding: 24px;

  box-sizing: border-box;

  background: #ffffff;

  color: #181818;

  overflow-y: auto;

}



.custom-fullscreen-close {

  align-self: flex-end;

  background: #eeeeee;

  border: none;

  border-radius: 6px;

  padding: 8px 12px;

  cursor: pointer;

  font-weight: 600;

  transition: background 0.2s ease;

}



.custom-fullscreen-close:hover {

  background: #dddddd;

}



.custom-fullscreen-sidebar h2,

.custom-fullscreen-sidebar h3 {

  margin: 0;

  font-weight: 700;

  line-height: 1.3;

}



.custom-fullscreen-sidebar h2 {

  font-size: 20px;

}



.custom-fullscreen-sidebar h3 {

  font-size: 16px;

  color: #555555;

}



.custom-fullscreen-sidebar p {

  margin: 0;

  font-size: 14px;

  line-height: 1.6;

}



.custom-fullscreen-sidebar ul {

  margin: 0;

  padding-left: 20px;

}



.custom-fullscreen-sidebar li {

  margin-bottom: 8px;

  line-height: 1.5;

}



.custom-fullscreen-sidebar li:last-child {

  margin-bottom: 0;

}



body.is-custom-fullscreen .custom-fullscreen-video-viewport .hokkaido-video-container {

  position: relative;

  top: 0;

  left: 0;

  width: 100%;

  height: 100%;

  flex: 1 1 auto;

  max-width: none;

  border-radius: 0;

  background: #000;

  display: flex;

  align-items: stretch;

  justify-content: center;

  overflow: hidden;

}



body.is-custom-fullscreen .hokkaido-video-container .vimeo-wrapper {

  position: absolute;

  inset: 0;

  border-radius: 0;

  transform: none;

  z-index: 1;

}



body.is-custom-fullscreen .hokkaido-video-container .vimeo-iframe {

  width: 100%;

  height: 100%;

  border-radius: 0;

  border: 0;

}



body.is-custom-fullscreen .hokkaido-video-container .vimeo-iframe {

  pointer-events: auto;

}



body.is-custom-fullscreen .hokkaido-video-container .vimeo-toggle-hitbox,

body.is-custom-fullscreen .hokkaido-video-container .hokkaido-video-frame,

body.is-custom-fullscreen .hokkaido-video-container .rectangle-comment,

body.is-custom-fullscreen .hokkaido-video-container .subtitle-container {

  display: none;

}



@media (max-width: 1024px) {

  .custom-fullscreen-wrapper {

    flex-direction: column;

  }



  .custom-fullscreen-video-area {

    flex: 1 1 auto;

  }



  .custom-fullscreen-sidebar {

    width: 100%;

    max-width: none;

    flex: 0 0 auto;

    border-top: 1px solid #eeeeee;

  }

}





  </style>

</head>



<body class="search-results-page">

  <section class="page" id="searchInterface">



    <!-- Sidebar -->

    <div id="sidebar" class="collapsed">

      <!-- Sidebar Icon Bar -->

      <div class="sidebar-icon-bar">

        <div class="sidebar-item" id="sidebar-toggle">

          <div class="icon">

            <img src="assets/arrow-left.svg" alt="Toggle Sidebar">

          </div>

        </div>



        <div class="sidebar-nav">

          <div class="sidebar-item">

            <div class="icon">

              <img src="assets/plus.svg" alt="New">

            </div>

          </div>



          <div class="sidebar-item active">

            <div class="icon">

              <img src="assets/search-icon.svg" alt="Home">

            </div>

            <span class="sidebar-label">ホーム</span>

          </div>



          <div class="sidebar-item">

            <div class="icon">

              <img src="assets/star.svg" alt="Saved">

            </div>

            <span class="sidebar-label">保存</span>

          </div>



          <div class="sidebar-item">

            <div class="icon">

              <img src="assets/discover.svg" alt="Discover">

            </div>

            <span class="sidebar-label">発見</span>

          </div>

        </div>

      </div>



      <!-- Sidebar Content Panel -->

      <div class="sidebar-content-panel">

        <div class="panel-header">

          <span class="panel-title">ホーム</span>

          <img src="assets/pin.svg" alt="Pin">

        </div>



        <div class="panel-section">

          <h3 class="subheader">チャット</h3>

          <ul class="chat-list">

            <li>海外旅行おすすめ</li>

          </ul>

        </div>

      </div>

    </div>





    <main id="page-content">

     

      <img src="Rectangle205.svg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0;">

      <div class="hokkaido-logo-container">

        <img src="Hokkaidologo.svg" alt="Hokkaido Logo" class="hokkaido-logo">

        <img src="ques.svg" alt="Question Icon" class="ques-icon">

        <div class="hokkaido-video-container" data-custom-fullscreen data-sidebar-title="Otaru" data-sidebar-subtitle="北海道の魅力：札幌＆小樽" data-sidebar-description="小樽は、北海道を代表する港町で、レトロな運河や石造りの倉庫群が魅力です。冬には雪化粧した街並みがロマンチックな雰囲気を醸し出します。" data-sidebar-list="雪景色で輝く小樽運河|札幌・すすきののナイトライフ|石造り倉庫とカフェ巡り">

          <!-- Vimeo iframe sits beneath the decorative frame -->

          <div class="vimeo-wrapper">

            <iframe

              class="vimeo-iframe"

              src="https://player.vimeo.com/video/1133040806?share=copy&fl=sv&fe=ci&autoplay=0&muted=0&controls=1&title=0&byline=0&portrait=0"

              allow="autoplay; fullscreen; picture-in-picture"

              allowfullscreen

              title="Hokkaido Experience"

            ></iframe>

          </div>



          <!-- Click overlay keeps native controls accessible (adjust bottom gap as needed) -->

          <div class="vimeo-toggle-hitbox" aria-hidden="true"></div>



          <!-- Decorative SVG frame stays visible on top -->

          <img src="hkdvideo.svg" alt="Video Frame" class="hokkaido-video-frame">

          <img src="Rectanglecomment.svg" alt="Comment Rectangle" class="rectangle-comment">

          <div id="hokkaido-subtitles" class="subtitle-container"></div>

        </div>

      </div>



       

        </main>

  </section>



    <div id="custom-fullscreen-overlay" class="custom-fullscreen-overlay" aria-hidden="true">

      <div class="custom-fullscreen-wrapper">

        <div class="custom-fullscreen-video-area">

          <div class="custom-fullscreen-video-viewport"></div>

        </div>

        <aside class="custom-fullscreen-sidebar">

          <button type="button" class="custom-fullscreen-close">✖ 关闭</button>

          <div class="custom-fullscreen-sidebar-content"></div>

        </aside>

      </div>

    </div>



  <script src="https://player.vimeo.com/api/player.js"></script>

  <script>

    document.addEventListener('DOMContentLoaded', () => {

      const iframe = document.querySelector('.vimeo-iframe');

      if (iframe) {

        const player = new Vimeo.Player(iframe);

        const toggleZone = document.querySelector('.vimeo-toggle-hitbox');



        if (toggleZone) {

          toggleZone.addEventListener('click', () => {

            player.getPaused().then((paused) => {

              if (paused) {

                player.play();

              } else {

                player.pause();

              }

            });

          });

        }

      }



      const searchInput = document.querySelector('.search-bar input');

      const searchQueryLabel = document.getElementById('search-query');

      const resultsGrid = document.getElementById('resultsGrid');

      const resultsEmpty = document.getElementById('resultsEmpty');

      const sidebarToggle = document.getElementById('sidebar-toggle');

      const sidebar = document.getElementById('sidebar');

      const pageContent = document.getElementById('page-content');



      const params = new URLSearchParams(window.location.search);

      const query = params.get('q')?.trim() || '';



      const sampleResults = [

        {

          title: '\u4eac\u90fd\u6587\u5316\u63a2\u7d22 3 \u65e5\u9593',

          description: '\u53e4\u90fd\u4eac\u90fd\u3067\u795e\u793e\u4ecf\u95a3\u5de1\u308a\u3068\u753a\u5bb6\u30ab\u30d5\u30a7\u3092\u582a\u80fd\u3002\u4f1d\u7d71\u5de5\u82b8\u306e\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\u3082\u4f53\u9a13\u3067\u304d\u307e\u3059\u3002',

          tags: ['culture', '\u4eac\u90fd', '\u6b74\u53f2', '\u5bfa\u9662'],

        },

        {

          title: '\u30a2\u30a4\u30b9\u30e9\u30f3\u30c9 \u30aa\u30fc\u30ed\u30e9\u30c4\u30a2\u30fc',

          description: '\u30ec\u30a4\u30ad\u30e3\u30d3\u30af\u3092\u62e0\u70b9\u306b\u3001\u6c37\u6cb3\u30cf\u30a4\u30ad\u30f3\u30b0\u3068\u5929\u7136\u6e29\u6cc9\u3092\u5de1\u308a\u306a\u304c\u3089\u5e7b\u60f3\u7684\u306a\u30aa\u30fc\u30ed\u30e9\u9451\u8cde\u3002',

          tags: ['overseas', '\u81ea\u7136', '\u5192\u967a'],

        },

        {

          title: '\u5317\u6d77\u9053 \u7f8e\u745b\u30fb\u5bcc\u826f\u91ce\u30c9\u30e9\u30a4\u30d6',

          description: '\u56db\u5b63\u6298\u3005\u306e\u98a8\u666f\u304c\u7f8e\u3057\u3044\u4e18\u3092\u5de1\u308b\u30c9\u30e9\u30a4\u30d6\u3002\u5730\u5143\u30b0\u30eb\u30e1\u3068\u6e29\u6cc9\u3067\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u3002',

          tags: ['domestic', '\u81ea\u7136', '\u5317\u6d77\u9053', '\u30c9\u30e9\u30a4\u30d6'],

        },

        {

          title: '\u30cb\u30e5\u30fc\u30b8\u30fc\u30e9\u30f3\u30c9 \u30cf\u30a4\u30ad\u30f3\u30b0\u5468\u904a',

          description: '\u30d5\u30a3\u30e8\u30eb\u30c9\u30e9\u30f3\u30c9\u56fd\u7acb\u516c\u5712\u3084\u30a2\u30d9\u30eb\u30fb\u30bf\u30ba\u30de\u30f3\u306a\u3069\u3001\u4e16\u754c\u5c48\u6307\u306e\u30c8\u30ec\u30a4\u30eb\u3092\u6b69\u304f\u65c5\u3002',

          tags: ['hiking', 'overseas', '\u81ea\u7136'],

        },

        {

          title: '\u702c\u6238\u5185\u30a2\u30fc\u30c8\u30a2\u30a4\u30e9\u30f3\u30c9\u5de1\u308a',

          description: '\u76f4\u5cf6\u30fb\u8c4a\u5cf6\u30fb\u72ac\u5cf6\u3067\u73fe\u4ee3\u30a2\u30fc\u30c8\u3068\u5cf6\u306e\u66ae\u3089\u3057\u306b\u89e6\u308c\u308b\u3001\u3086\u3063\u305f\u308a\u30d5\u30a7\u30ea\u30fc\u65c5\u3002',

          tags: ['culture', 'domestic', '\u30a2\u30fc\u30c8'],

        }

      ];



      function normalize(text) {

        return text.toLowerCase();

      }



      function filterResults(keyword) {

        if (!keyword) {

          return sampleResults.slice(0, 3);

        }



        const normalized = normalize(keyword);

        return sampleResults.filter((item) => {

          const titleMatch = normalize(item.title).includes(normalized);

          const descriptionMatch = normalize(item.description).includes(normalized);

          const tagMatch = item.tags.some((tag) => normalize(tag).includes(normalized));

          return titleMatch || descriptionMatch || tagMatch;

        });

      }



      function renderResults(list) {

        if (!resultsGrid || !resultsEmpty) {

          return;

        }



        resultsGrid.innerHTML = '';



        if (!list.length) {

          resultsEmpty.classList.remove('hidden');

          return;

        }



        resultsEmpty.classList.add('hidden');



        list.forEach((item) => {

          const card = document.createElement('article');

          card.className = 'result-card';

          card.innerHTML = `

            <h2>${item.title}</h2>

            <p>${item.description}</p>

            <div class="tag-list">

              ${item.tags.map((tag) => `<span class="tag">${tag}</span>`).join('')}

            </div>

          `;

          resultsGrid.appendChild(card);

        });

      }



      if (searchQueryLabel) {

        searchQueryLabel.textContent = query || '\u304a\u3059\u3059\u3081';

      }



      if (searchInput) {

        if (query) {

          searchInput.value = query;

        }



        searchInput.addEventListener('keydown', (event) => {

          if (event.key !== 'Enter') {

            return;

          }



          event.preventDefault();

          const value = searchInput.value.trim();

          if (!value) {

            return;

          }



          const destination = new URL(window.location.href);

          destination.searchParams.set('q', value);

          window.location.href = destination.toString();

        });

      }



      if (sidebar && sidebarToggle && pageContent) {

        sidebarToggle.addEventListener('click', () => {

          sidebar.classList.toggle('collapsed');

          pageContent.classList.toggle('sidebar-collapsed');

        });

      }



      renderResults(filterResults(query));

    });



  window.addEventListener('scroll', () => {

  const scrollX = window.scrollX || document.documentElement.scrollLeft;



  // Sidebar 同步

  const sidebar = document.getElementById('sidebar');

  if (sidebar) {

    sidebar.style.left = `${scrollX}px`;

  }



  // Ques.svg 同步

  const quesIcon = document.querySelector('.ques-icon');

  if (quesIcon) {

    const baseLeft = -670; // 你原本的 CSS 定位值

    quesIcon.style.left = `${scrollX + baseLeft}px`;

  }

});



document.addEventListener('DOMContentLoaded', () => {

  const iframe = document.querySelector('.hokkaido-video-container .vimeo-iframe');

  const subtitleContainer = document.getElementById('hokkaido-subtitles');



  if (!iframe || !subtitleContainer) return;



  const player = new Vimeo.Player(iframe);



  const subtitleConfigs = [

    {

      title: '北海道冬の魅力：札幌＆小樽',

      description: '小樽は、北海道を代表する港町で、レトロな運河や石造りの倉庫群が魅力です。冬には雪に包まれた街並みがロマンチックな雰囲気を醸し出し、夜には大都市にも負けないイルミネーションとグルメが楽しめます。',

      titleSpeed: 28,

      descSpeed: 34,

    },

    {

      title: '船見坂',

      description: '映画『Love Letter』のロケ地。坂の上から港と街並みを一望できる。',

      titleSpeed: 28,

      descSpeed: 40,

    },

    {

      title: 'すすきの交差点',

      description: '札幌最大の繁華街すすきの。NIKKAのネオンが輝き、飲食店やショップが並ぶにぎやかな夜の街。',

      titleSpeed: 28,

      descSpeed: 30,

    },

    {

      title: '藻岩山の夜景',

      description: '藻岩山は「日本新三大夜景」の一つ。ロープウェイで登ると、札幌の街が宝石のように輝く絶景を望めます。',

      titleSpeed: 30,

      descSpeed: 41,

    },

    {

      title: '白い恋人ソフトクリーム',

      description: '北海道を代表するお土産。',

      titleSpeed: 28,

      descSpeed: 24,

    },

    {

      title: 'うな重',

      description: 'うな重は全国で親しまれる日本料理の一つ。',

      titleSpeed: 42,

      descSpeed: 70,

    },

    {

      title: 'ジンギスカン',

      description: '北海道名物のジンギスカン。ラム肉と野菜を特製鍋で焼き、タレと相性抜群の一品。',

      titleSpeed: 40,

      descSpeed: 50,

    },

    {

      title: '元祖さっぽろラーメン横丁',

      description: '札幌は味噌ラーメン発祥の地。ラーメン横丁には昭和の雰囲気の老舗が並び、熱々の一杯が楽しめます。',

      titleSpeed: 30,

      descSpeed: 30,

    },

    {

      title: '大通公園＆さっぽろテレビ塔',

      description: '札幌中心の大通公園は市民の憩いの場。冬はホワイトイルミネーションや雪まつりで街が彩られます。',

      titleSpeed: 37,

      descSpeed: 30,

    },

  ];



  const WAIT_AFTER_GROUP = 1000;



  class SubtitleController {

    constructor(configs, container) {

      this.configs = configs;

      this.container = container;

      this.started = false;

      this.paused = false;

      this.currentGroup = 0;

      this.stage = 'idle';

      this.titleIndex = 0;

      this.descIndex = 0;

      this.currentTimeout = null;

      this.waitRemaining = WAIT_AFTER_GROUP;

      this.waitStart = null;

      this.titleLine = null;

      this.titleText = null;

      this.descLine = null;

      this.descText = null;

    }



    clearCurrentTimeout() {

      if (this.currentTimeout !== null) {

        clearTimeout(this.currentTimeout);

        this.currentTimeout = null;

      }

    }



    prepareCurrentGroup() {

      const group = this.configs[this.currentGroup];

      if (!group) return;



      this.container.innerHTML = '';



      const titleLine = document.createElement('div');

      titleLine.className = 'subtitle-line subtitle-title';

      const titleText = document.createElement('span');

      titleText.className = 'subtitle-text';

      const titleCursor = document.createElement('span');

      titleCursor.className = 'subtitle-cursor';

      titleCursor.textContent = '|';

      titleLine.append(titleText, titleCursor);



      const descLine = document.createElement('div');

      descLine.className = 'subtitle-line subtitle-description';

      const descText = document.createElement('span');

      descText.className = 'subtitle-text';

      const descCursor = document.createElement('span');

      descCursor.className = 'subtitle-cursor';

      descCursor.textContent = '|';

      descLine.append(descText, descCursor);



      this.container.appendChild(titleLine);

      this.container.appendChild(descLine);



      this.titleLine = titleLine;

      this.titleText = titleText;

      this.descLine = descLine;

      this.descText = descText;



      this.titleLine.classList.remove('is-complete');

      this.descLine.classList.remove('is-complete');

      this.titleLine.classList.remove('is-typing');

      this.descLine.classList.remove('is-typing');



      this.titleText.textContent = '';

      this.descText.textContent = '';

    }



    start() {

      if (!this.configs.length) return;



      this.started = true;

      this.paused = false;

      this.currentGroup = 0;

      this.stage = 'title';

      this.titleIndex = 0;

      this.descIndex = 0;

      this.waitRemaining = WAIT_AFTER_GROUP;

      this.prepareCurrentGroup();

      this.scheduleNextStep();

    }



    pause() {

      if (!this.started || this.paused) return;

      this.paused = true;



      if (this.stage === 'wait' && this.waitStart) {

        const elapsed = Date.now() - this.waitStart;

        this.waitRemaining = Math.max(0, this.waitRemaining - elapsed);

      }



      this.clearCurrentTimeout();

    }



    resume() {

      if (!this.started || !this.paused) return;

      this.paused = false;



      if (this.stage === 'wait') {

        if (this.waitRemaining <= 0) {

          this.advanceGroup();

        } else {

          this.waitStart = Date.now();

          this.currentTimeout = setTimeout(() => this.advanceGroup(), this.waitRemaining);

        }

        return;

      }



      this.scheduleNextStep();

    }



    reset() {

      this.clearCurrentTimeout();

      this.started = false;

      this.paused = false;

      this.currentGroup = 0;

      this.stage = 'idle';

      this.titleIndex = 0;

      this.descIndex = 0;

      this.waitRemaining = WAIT_AFTER_GROUP;

      this.waitStart = null;

      this.container.innerHTML = '';

    }



    scheduleNextStep() {

      if (!this.started || this.paused) return;



      const group = this.configs[this.currentGroup];

      if (!group) return;



      if (this.stage === 'title') {

        this.titleLine.classList.add('is-typing');

        if (this.titleIndex < group.title.length) {

          this.titleText.textContent += group.title[this.titleIndex];

          this.titleIndex += 1;

          this.currentTimeout = setTimeout(() => this.scheduleNextStep(), group.titleSpeed);

        } else {

          this.titleLine.classList.remove('is-typing');

          this.titleLine.classList.add('is-complete');

          this.stage = 'description';

          this.scheduleNextStep();

        }

        return;

      }



      if (this.stage === 'description') {

        this.descLine.classList.add('is-typing');

        if (this.descIndex < group.description.length) {

          this.descText.textContent += group.description[this.descIndex];

          this.descIndex += 1;

          this.currentTimeout = setTimeout(() => this.scheduleNextStep(), group.descSpeed);

        } else {

          this.descLine.classList.remove('is-typing');

          this.descLine.classList.add('is-complete');

          this.stage = 'wait';

          this.waitRemaining = WAIT_AFTER_GROUP;

          this.waitStart = Date.now();

          this.currentTimeout = setTimeout(() => this.advanceGroup(), this.waitRemaining);

        }

      }

    }



    advanceGroup() {

      this.clearCurrentTimeout();

      if (!this.started || this.paused) return;



      this.currentGroup = (this.currentGroup + 1) % this.configs.length;

      this.stage = 'title';

      this.titleIndex = 0;

      this.descIndex = 0;

      this.waitRemaining = WAIT_AFTER_GROUP;

      this.waitStart = null;

      this.prepareCurrentGroup();

      this.scheduleNextStep();

    }

  }



  const subtitleController = new SubtitleController(subtitleConfigs, subtitleContainer);



  player.on('play', () => {

    // 当 "play" 事件触发时，获取当前时间

    player.getCurrentTime().then((seconds) => {

      // 如果视频是从头开始播放（包括结束后重播）

      if (seconds <= 0.1) {

        subtitleController.reset(); // 确保字幕被重置

        subtitleController.start(); // 从头开始播放字幕

      } else {

        // 如果是从中途暂停后继续播放

        if (!subtitleController.started) {

          subtitleController.start(); // 以防万一，如果还没开始就启动

        } else {

          subtitleController.resume(); // 否则就恢复

        }

      }

    }).catch(() => {

      // 如果获取时间失败，使用旧的逻辑

      if (!subtitleController.started) {

        subtitleController.start();

      } else {

        subtitleController.resume();

      }

    });

  });



  player.on('pause', () => {

    subtitleController.pause();

  });



  player.on('ended', () => {

    subtitleController.reset(); // 视频结束时重置字幕

  });



  player.on('seeked', ({ seconds }) => {

    // 这个逻辑现在只处理“在暂停时手动拖动到开头”的情况

    if (seconds <= 0.1) {

      player.getPaused().then((paused) => {

        if (paused) {

          subtitleController.reset(); // 如果是暂停时拖动到开头，重置

        }

      });

    }

  });

}); // <--- 这是 subtitle 'DOMContentLoaded' 事件的结尾







document.addEventListener('DOMContentLoaded', () => {

  const overlay = document.getElementById('custom-fullscreen-overlay');

  if (!overlay || typeof Vimeo === 'undefined' || !Vimeo.Player) {

    return;

  }



  const htmlEl = document.documentElement;

  const bodyEl = document.body;

  const wrapper = overlay.querySelector('.custom-fullscreen-wrapper');

  const videoViewport = overlay.querySelector('.custom-fullscreen-video-viewport');

  const sidebarContent = overlay.querySelector('.custom-fullscreen-sidebar-content');

  const closeButton = overlay.querySelector('.custom-fullscreen-close');



  if (!videoViewport || !sidebarContent) {

    return;

  }



  let activeContext = null;



  function populateSidebar(data) {

    sidebarContent.innerHTML = '';

    if (!data) {

      return;

    }



    if (data.title) {

      const titleEl = document.createElement('h2');

      titleEl.textContent = data.title;

      sidebarContent.appendChild(titleEl);

    }



    if (data.subtitle) {

      const subtitleEl = document.createElement('h3');

      subtitleEl.textContent = data.subtitle;

      sidebarContent.appendChild(subtitleEl);

    }



    if (data.description) {

      const descEl = document.createElement('p');

      descEl.textContent = data.description;

      sidebarContent.appendChild(descEl);

    }



    if (data.list && data.list.length) {

      const listEl = document.createElement('ul');

      data.list.forEach((item) => {

        const li = document.createElement('li');

        li.textContent = item;

        listEl.appendChild(li);

      });

      sidebarContent.appendChild(listEl);

    }

  }



    function exitCustomFullscreen() {

      if (!activeContext) {

        return;

      }



      const context = activeContext;

      const { container } = context;

      let { placeholder } = context;



      overlay.setAttribute('aria-hidden', 'true');

      bodyEl.classList.remove('is-custom-fullscreen');

      htmlEl.classList.remove('is-custom-fullscreen');



      sidebarContent.innerHTML = '';



      if (placeholder && placeholder.parentNode) {

        placeholder.parentNode.insertBefore(container, placeholder);

        placeholder.remove();

      } else if (context.originalParent) {

        context.originalParent.insertBefore(container, context.originalNextSibling || null);

        if (placeholder && typeof placeholder.remove === 'function') {

          placeholder.remove();

        }

      }



      if (!placeholder || !placeholder.isConnected) {

        placeholder = document.createComment('custom-fullscreen-placeholder');

        context.placeholder = placeholder;

      }



      context.originalParent = container.parentNode;

      context.originalNextSibling = container.nextSibling;



      activeContext = null;

    }



    function enterCustomFullscreen(context) {

      if (!context) {

        return;

      }



      if (activeContext && activeContext !== context) {

        exitCustomFullscreen();

      }



      const { container } = context;

      let { placeholder } = context;



      if (!placeholder || (typeof Node !== 'undefined' && placeholder.nodeType !== Node.COMMENT_NODE)) {

        placeholder = document.createComment('custom-fullscreen-placeholder');

        context.placeholder = placeholder;

      }



      if (container.parentNode !== videoViewport) {

        if (container.parentNode) {

          container.parentNode.insertBefore(placeholder, container);

        }

        videoViewport.appendChild(container);

      }



      populateSidebar(context.getSidebarData ? context.getSidebarData() : null);



      overlay.setAttribute('aria-hidden', 'false');

      bodyEl.classList.add('is-custom-fullscreen');

      htmlEl.classList.add('is-custom-fullscreen');



      activeContext = context;

    }



  closeButton?.addEventListener('click', exitCustomFullscreen);



  overlay.addEventListener('click', (event) => {

    if (event.target === overlay) {

      exitCustomFullscreen();

    }

  });



  wrapper?.addEventListener('click', (event) => {

    event.stopPropagation();

  });



  document.addEventListener('keydown', (event) => {

    if (event.key === 'Escape') {

      exitCustomFullscreen();

    }

  });



  const containers = document.querySelectorAll('[data-custom-fullscreen]');



  containers.forEach((container) => {

    const iframe = container.querySelector('iframe');

    if (!iframe) {

      return;

    }



      const context = {

        container,

        placeholder: document.createComment('custom-fullscreen-placeholder'),

        originalParent: container.parentNode,

        originalNextSibling: container.nextSibling,

        getSidebarData() {

          const listAttr = container.getAttribute('data-sidebar-list') || '';

          return {

            title: container.getAttribute('data-sidebar-title') || '',

            subtitle: container.getAttribute('data-sidebar-subtitle') || '',

            description: container.getAttribute('data-sidebar-description') || '',

            list: listAttr

              .split('|')

              .map((item) => item.trim())

              .filter(Boolean),

          };

        },

      };



    const player = new Vimeo.Player(iframe);



      player.on('fullscreenchange', (data) => {

        if (data && data.fullscreen) {

          const openOverlay = () => {

            enterCustomFullscreen(context);

          };



          if (typeof player.exitFullscreen === 'function') {

            player

              .exitFullscreen()

              .catch(() => {})

              .then(openOverlay);

          } else {

            openOverlay();

          }

          return;

        }



        if (data && data.fullscreen === false && activeContext === context) {

          exitCustomFullscreen();

        }

      });



    container.addEventListener('custom-fullscreen:open', () => {

      enterCustomFullscreen(context);

    });



    container.addEventListener('custom-fullscreen:close', () => {

      exitCustomFullscreen();

    });

  });

});







    </script>

</body>

</html> 
